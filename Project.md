# Optimize a Neural Network with Systolic Array
## Introduction
In previous tutorials and homework, we have optimized the matrix multiplication (HW5) and CNN (T6) by SDSOC. 
In the final project, you are required to optimize a convolution functions in SkyNet with systolic array. 
  - SkyNet is a hardware efficient neural network that won the champions on both FPGA and GPU platforms in the 56th IEEE/ACM Design Automation Conference (DAC-SDC).  More information for SkyNet: https://arxiv.org/pdf/1909.09709.pdf
  - Systolic arrays are often hard-wired for specific operations, such as "multiply and accumulate", to perform massively parallel integration, convolution, correlation, matrix multiplication or data sorting tasks. A major benefit of systolic arrays is that all operand data and partial results are stored within (passing through) the processor array. 
  - To save the computational complexity and reduce the parameters, SkyNet separates normal convolution into two parts, pixelwise and depthwise convolution. A brief introduction on separable convolution: https://towardsdatascience.com/a-basic-introduction-to-separable-convolutions-b99ec3102728


## Provided Resources
We have provided the following code in [<src/Project/src>](<src/Project/src>) 
1. A baseline version of SkyNet: [<src/Project/src>](<src/Project/src>). 

To accelerate debug, we recommend you to debug the function of PWCONV1X1 under standard g++ environment rather than Vivado HLS environment, the following commands enable you to compile the HLS C code using g++ in Linux.
```
sudo cp ap_int.h /usr/include
mkdir build
cd build
cmake ..
ln -s ../blob
ln -s ../weight
make
./SkyNet
```

If you are not familiar with Linux, you can also debug the code in Visual Studio on Windows. The running time in Vivado HLS is very long, because HLS uses a lower version of the g++ compiler internally.

2. Slides on systolic array and its RTL implementation. [<src/Project/Systolic_Array_Introduction.pdf>](<src/Project/Systolic_Array_Introduction.pdf>).
3. A series of examples of matrix multiplication of HLS are given in  https://github.com/spcl/hls_tutorial_examples. These examples are progressive and a complete systolic example is given in example7.
4. A typical example which directly corresponds to the HDL code is provided in src/Project/example. 
5. The state-of-the-art implementation of the systolic array with HLS is provided in https://github.com/spcl/gemm_hls
6. You can also refer to [AutoSA: Polyhedral-Based Systolic Array Auto-Compilation](https://github.com/UCLA-VAST/AutoSA). You can even use the code generated by him directly. But please reflect all the information you have referred to and your own workload in the report. 
7. SDSoC also provides an official implementation of systolic array. You can find it in the examples of SDx.


## Requirement
You are required to optimize the PWCONV1X1 function and DWCONV3X3 function with systolic array.
- Guarantee the result is correct;
- Systolic array of PWCONV1X1 is mandatory;
- Any optimizations can be applied to the hardware function SkyNet() to obtain higher performance. (Optional)
- Record the problems you encountered as well as the effort to optimize the performance.
- Summarize your optimization route and learning gains.

## Standard for Evaluation
- Correct implementation of systolic array in pixelwise convolution: 30'
- The running time of the accelerator is measured. The speedup ratio compared to the baseline should be greater than 30x: 20'
- The speedup ratio will participate in the ranking. The first place will get 30 points. The second place will get 29 points. And so on. All students ranked after 20 will get 10 points.
- You can show your innovations in the report and request at most 20 extra points in total. Note: The evaluation of innovations is very strict.
- Others: 20' (report writing, interesting ideas...)

## Submit
You should submit:
- all your code
- all the files in the Release/_sds/reports
- Report.pdf (The correct result screenshot. The optimization strategies and the problems you encountered. The performance and resources utilization. Your innovations andYour innovations and the significance and far-reaching impact of these innovations. Some necessary descriptions.)

File Organization Schema in Package:
EE216_project_[Name][ID].zip
- src
- reports
- Report.pdf